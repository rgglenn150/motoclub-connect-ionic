<ion-card class="weather-card" [ngClass]="ridingConditions?.colorClass || 'condition-loading'">
  
  <div *ngIf="isLoading" class="state-container loading-container">
    <ion-spinner name="crescent"></ion-spinner>
    <p *ngIf="!isGettingLocation">Checking the skies...</p>
    <p *ngIf="isGettingLocation">Getting your location...</p>
  </div>

  <div *ngIf="hasError" class="state-container error-container">
    <ion-icon name="cloud-offline-outline"></ion-icon>
    <p class="error-message">{{ errorMessage }}</p>
    <ion-button fill="clear" class="retry-button" (click)="refreshWeatherWithLocation()">
      <ion-icon slot="start" name="refresh"></ion-icon>
      Retry
    </ion-button>
  </div>

  <div *ngIf="!isLoading && !hasError && currentWeather && ridingConditions">
    <ion-card-header>
      <div class="header-content">
        <div class="location">
          <ion-icon name="location-outline" class="location-icon" [class.location-updating]="isGettingLocation"></ion-icon>
          {{ locationName }}
          <ion-spinner *ngIf="isGettingLocation" name="dots" size="small" class="location-spinner"></ion-spinner>
        </div>
        <div class="last-updated">
          Weather as of {{ lastUpdated ? (lastUpdated | date:'shortTime') : '' }}
          <ion-icon name="refresh" class="refresh-icon" (click)="refreshWeatherWithLocation()"
                    [class.refreshing]="isLoading || isGettingLocation"></ion-icon>
        </div>
      </div>
    </ion-card-header>

    <ion-card-content>
      <div class="verdict-section">
        <div class="verdict-icon-container">
          <app-weather-svg-icon [iconType]="ridingConditions.animatedIconType" size="medium" [animated]="true"></app-weather-svg-icon>
        </div>
        <h2 class="verdict-title">{{ ridingConditions.title }}</h2>
        <p class="verdict-advice">{{ ridingConditions.advice }}</p>
      </div>

      <div class="divider"></div>

      <div class="metrics-section">
        
        <div class="metric-item">
          <div class="metric-value">
            <ion-icon name="thermometer-outline" class="metric-icon"></ion-icon>
            {{ currentWeather.temperature.current | number:'1.0-0' }}<span class="metric-unit">Â°C</span>
          </div>
          <div class="metric-label">Temperature</div>
        </div>

        <div class="metric-item">
          <div class="metric-value">
            <ion-icon name="cloud-download-outline" class="metric-icon"></ion-icon>
            {{ currentWeather.forecast && currentWeather.forecast[0] ? currentWeather.forecast[0].precipitationChance : 0 }}<span class="metric-unit">%</span>
          </div>
          <div class="metric-label">Rain Chance</div>
        </div>

        <div class="metric-item">
          <div class="metric-value">
            <ion-icon name="leaf-outline" class="metric-icon"></ion-icon>
            {{ currentWeather.metrics.windSpeed | number:'1.0-0' }}<span class="metric-unit"> km/h</span>
          </div>
          <div class="metric-label">Wind</div>
        </div>

      </div>
    </ion-card-content>
  </div>

</ion-card>