<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/home"></ion-back-button>
    </ion-buttons>
    <ion-title>Notifications</ion-title>
    <ion-buttons slot="end">
      <ion-button 
        fill="clear" 
        (click)="markAllAsRead()"
        [disabled]="loading || notifications.length === 0">
        <ion-icon name="checkmark-done-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Refresher -->
  <ion-refresher slot="fixed" (ionRefresh)="onRefresh($event)">
    <ion-refresher-content
      pulling-icon="chevron-down-circle-outline"
      pulling-text="Pull to refresh"
      refreshing-spinner="dots"
      refreshing-text="Refreshing notifications...">
    </ion-refresher-content>
  </ion-refresher>

  <!-- Loading State -->
  <div *ngIf="loading && currentPage === 1" class="loading-state">
    <ion-spinner name="dots" color="primary"></ion-spinner>
    <p>Loading notifications...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-state">
    <ion-icon name="warning-outline" color="warning"></ion-icon>
    <h3>Oops! Something went wrong</h3>
    <p>{{ error }}</p>
    <ion-button fill="outline" (click)="retry()">
      <ion-icon name="refresh" slot="start"></ion-icon>
      Try Again
    </ion-button>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && !error && notifications.length === 0" class="empty-state">
    <ion-icon name="notifications-off-outline" color="medium"></ion-icon>
    <h3>No notifications yet</h3>
    <p>You'll see notifications here when clubs or events have updates.</p>
    <ion-button fill="outline" routerLink="/tabs/clubs">
      <ion-icon name="people" slot="start"></ion-icon>
      Browse Clubs
    </ion-button>
  </div>

  <!-- Notifications List -->
  <div *ngIf="!loading && !error && notifications.length > 0" class="notifications-container">
    <ion-list lines="none">
      <ion-item-sliding 
        *ngFor="let notification of notifications; trackBy: trackByNotificationId"
        class="notification-sliding-item">
        
        <!-- Main notification item -->
        <ion-item 
          button
          class="notification-item"
          [class.unread]="!notification.read"
          (click)="onNotificationClick(notification)">
          
          <div class="notification-icon" slot="start">
            <ion-icon 
              [name]="getNotificationIcon(notification.type)"
              [color]="getNotificationColor(notification.type)">
            </ion-icon>
          </div>

          <ion-label>
            <div class="notification-content">
              <p class="notification-message">
                {{ formatMessage(notification) }}
              </p>
              <div class="notification-meta">
                <small class="notification-time">
                  {{ getTimeAgo(notification.createdAt) }}
                </small>
                <ion-badge 
                  *ngIf="!notification.read" 
                  color="primary" 
                  class="unread-badge">
                  New
                </ion-badge>
              </div>
            </div>
          </ion-label>

          <ion-button 
            fill="clear" 
            slot="end" 
            (click)="deleteNotification(notification, $event)"
            class="delete-button">
            <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
          </ion-button>
        </ion-item>

        <!-- Sliding options -->
        <ion-item-options side="end">
          <ion-item-option 
            *ngIf="!notification.read"
            color="primary" 
            (click)="markAsRead(notification._id)">
            <ion-icon name="checkmark" slot="icon-only"></ion-icon>
          </ion-item-option>
          
          <ion-item-option 
            color="danger" 
            (click)="deleteNotification(notification, $event)">
            <ion-icon name="trash" slot="icon-only"></ion-icon>
          </ion-item-option>
        </ion-item-options>
      </ion-item-sliding>
    </ion-list>

    <!-- Load More Button -->
    <div class="load-more-container" *ngIf="hasMore">
      <ion-button 
        expand="block" 
        fill="outline" 
        (click)="loadMore()"
        [disabled]="loadingMore"
        class="load-more-button">
        <ion-spinner name="dots" *ngIf="loadingMore"></ion-spinner>
        <span *ngIf="!loadingMore">Load More Notifications</span>
        <span *ngIf="loadingMore">Loading...</span>
      </ion-button>
    </div>

    <!-- End of list indicator -->
    <div class="end-indicator" *ngIf="!hasMore && notifications.length > 5">
      <small>You've reached the end of your notifications</small>
    </div>
  </div>

  <!-- Infinite Scroll -->
  <ion-infinite-scroll 
    *ngIf="hasMore && !loadingMore"
    threshold="100px" 
    (ionInfinite)="loadMore($event)">
    <ion-infinite-scroll-content
      loading-spinner="bubbles"
      loading-text="Loading more notifications...">
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>
</ion-content>